experiment:
  name: snap_harvester_live_btc
  seed: 42

data:
  symbols:
    - "BTCUSDT"

  # Historical minutes for replay / warmup (aggTrades v2 bars).
  bars_path_template: "data/minutes/{symbol}_1min_2025.parquet"
  bars_time_col: "timestamp"
  bars_open_col: "open"
  bars_high_col: "high"
  bars_low_col: "low"
  bars_close_col: "close"
  bars_volume_col: "volume"

  # ShockFlip meta events (research-parity aggTrades set).
  events_path: "results/meta/snap_meta_dataset_2025_BTC_agg.csv"
  events_time_col: "timestamp"

integrity:
  price_tolerance: 1e-4
  event_snap_minutes: 1
  drop_misaligned_events: true
  log_misaligned_events: true
  max_risk_to_price_ratio: 5.0

# Risk block identical to snap_harvester_2024_btc.yaml
risk:
  risk_k_atr: 0.5
  sl_r_multiple: 2.5
  tp_r_multiple: 4.0
  be_r_multiple: 1.0
  be_k_atr: 0.0
  tp_k_atr: 0.0
  horizon_bars: 30
  target_r_multiple: 4.0

meta:
  label_col: "y_win_R4_SL2p5"
  barrier_col: "barrier_y_H30_R4p0_sl2p5"
  r_multiple_col: "r_final"
  mfe_col: "mfe_r"
  mae_col: "mae_r"
  exclude_feature_cols:
    - "event_id"
    - "event_bar_time"
    - "event_bar_offset_min"
    - "exit_time"
    - "hit_be"
    - "hit_tp"
    - "hit_sl"
    - "p_hat"
    - "risk_profile"
  train_features:
    - side
    - open
    - high
    - low
    - close
    - atr
    - atr_pct
    - rel_vol
    - imbalance
    - imbalance_z
    - shockflip_z
    - shock_intensity_z
    - range_atr
    - donchian_loc
    - price_flow_div
    - prior_flow_sign
    - div_score
    - trend_dir
    - trend_aligned
    - trend_slope
    - stall_flag
    - shock_intensity_z_decile
    - div_score_decile
    - rel_vol_decile
  diagnostics_only_features:
    - mfe6_atr
    - mfe10_atr
    - mfe20_atr
    - mfe30_atr
    - mfe60_atr
    - mfe120_atr
    - mfe240_atr
    - did_snap_H6_K0_5
    - did_snap_H6_K0_75
    - did_snap_H6_K1_0
    - did_snap_H10_K0_5
    - did_snap_H10_K0_75
    - did_snap_H10_K1_0
    - did_snap_H20_K0_5
    - did_snap_H20_K0_75
    - did_snap_H20_K1_0
    - did_snap_H30_K0_5
    - did_snap_H30_K0_75
    - did_snap_H30_K1_0
    - did_snap_H60_K0_5
    - did_snap_H60_K0_75
    - did_snap_H60_K1_0
    - did_snap_H120_K0_5
    - did_snap_H120_K0_75
    - did_snap_H120_K1_0
    - did_snap_H240_K0_5
    - did_snap_H240_K0_75
    - did_snap_H240_K1_0
  max_category_cardinality: 20

paths:
  replay_trades_out: "results/live/replay_routed_tape_2025_BTC.csv"

# Live ShockFlip geometry aligned with Nov 2025 OOS walkforward
shockflip:
  # Research-parity geometry (diamond_hunter baseline, aggTrades study).
  z_band: 2.0
  jump_band: 2.5
  persistence_bars: 4
  z_window: 240
  donchian_window: 120
  location_require_extreme: true
  min_bars: 240

live:
  # Frozen 2024 BTC meta-model
  model_path: "results/models/hgb_snap_2024_BTC_agg.joblib"

  # If use_ml_routing=false, all ShockFlips are routed with the strategy profile.
  use_ml_routing: true
  min_p_hat: 0.35
  # Health heartbeat (HEARTBEAT messages / Telegram), seconds.
  # Increased from 60s default to reduce notification clustering.
  health_heartbeat_sec: 3600

  # Execution / alerts are configured via the binance:/telegram: blocks below.

binance:
  symbol: "BTCUSDT"
# USDT-M Futures MAINNET for data; TESTNET execution is controlled by testnet=true in execution.py
  base_url: "https://fapi.binance.com"
  ws_url: "wss://fstream.binance.com/ws"
  api_key_env: "BINANCE_API_KEY"
  api_secret_env: "BINANCE_API_SECRET"
  recv_window_ms: 5000
  testnet: true

  # Feed / safety
  use_kline_stream: true
  kline_interval: "1m"
  heartbeat_sec: 120
  stale_timeout_sec: 120
  backfill_bars: 240

  # Execution
  use_oco_brackets: true
  max_retries: 3
  order_timeout_sec: 5
  quote_risk_per_trade: 50.0
  max_open_trades: 1

telegram:
  enabled: true
  bot_token_env: "TELEGRAM_BOT_TOKEN"
  chat_id_env: "TELEGRAM_CHAT_ID"

  # Noise control
  send_events: true
  send_trade_open: true
  send_trade_close: true
  send_health: true
  daily_summary_hour_utc: 21
